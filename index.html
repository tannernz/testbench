<!DOCTYPE html>
<html>
  <head>
    <title>Zone Checker</title>
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      #map {
        height: 100%;
        width: 100%;
      }

      /* Consultant emoji background */
      .consultantLabel {
        background: white;
        padding: 4px 6px;
        border-radius: 50%;
        border: 1px solid #ccc;
      }

      /* Toggle button styling */
      #toggleCirclesBtn {
        position: absolute;
        top: 15px;
        left: 15px;
        z-index: 9999;
        background: white;
        padding: 10px 16px;
        border-radius: 8px;
        font-size: 15px;
        border: 1px solid #888;
        cursor: pointer;
        box-shadow: 0px 2px 6px rgba(0,0,0,0.25);
      }

      #toggleCirclesBtn:hover {
        background: #f2f2f2;
      }
    </style>

  </head>

  <body>
    <button id="toggleCirclesBtn">35km Button</button>
    <div id="map"></div>

    <script>
      let map;
      let branchCircles = []; // store 35km circles

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: -36.8509, lng: 174.7645 }, // Auckland default
          zoom: 6,
          mapId: "65037f52b8d8b2c1" // Your MapID
        });

        const buildingIcon = {
          url: "https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/geocode-71.png",
          scaledSize: new google.maps.Size(40, 40),
        };

        /* ------------------------------
           BRANCH LOCATIONS
        --------------------------------*/
        const branchLocations = [
          { title: "Albany Branch", lat: -36.726, lng: 174.709 },
          { title: "CBD Branch", lat: -36.848, lng: 174.763 },
          { title: "Manukau Branch", lat: -37.0, lng: 174.872 }
        ];

        branchLocations.forEach(branch => {
          // Branch marker
          new google.maps.Marker({
            position: { lat: branch.lat, lng: branch.lng },
            map: map,
            icon: buildingIcon,
            title: branch.title
          });

          // 35km radius circle
          const circle = new google.maps.Circle({
            strokeColor: "#0000FF",
            strokeOpacity: 0.5,
            strokeWeight: 1,
            fillColor: "#0000FF",
            fillOpacity: 0.12,
            map: map,
            center: { lat: branch.lat, lng: branch.lng },
            radius: 35000
          });

          branchCircles.push(circle);
        });

        /* ------------------------------
           CONSULTANT LOCATIONS
        --------------------------------*/
        const consultantLocations = [
          { title: "Consultant A", lat: -36.85, lng: 174.76 },
          { title: "Consultant B", lat: -36.9, lng: 174.8 }
        ];

        consultantLocations.forEach(c => {
          new google.maps.Marker({
            position: { lat: c.lat, lng: c.lng },
            map: map,
            label: {
              text: "ðŸ‘¤",
              fontSize: "22px",
              color: "#000",
              className: "consultantLabel"
            },
            title: c.title
          });
        });

        /* ------------------------------
           LOAD YOUR ZONES + REGIONS GEOJSON
        --------------------------------*/
        map.data.loadGeoJson("zones.geojson");     // Your zones
        map.data.loadGeoJson("regions.geojson");   // Your invisible region polygons

        // Color zones red
        map.data.setStyle(feature => {
          if (feature.getProperty("type") === "region") {
            return {
              visible: false,   // keep regions invisible
              clickable: false
            };
          }
          return {
            fillColor: "red",
            fillOpacity: 0.35,
            strokeColor: "red",
            strokeWeight: 1
          };
        });

        /* ------------------------------
           35km toggle button
        --------------------------------*/
        document.getElementById("toggleCirclesBtn").addEventListener("click", () => {
          branchCircles.forEach(circle => {
            circle.setMap(circle.getMap() ? null : map);
          });
        });
      }
    </script>

    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCLJtsETdc-9JYoDpN9pua3Thz1rBjGmBc&libraries=geometry&callback=initMap"
      defer>
    </script>
  </body>
</html>
